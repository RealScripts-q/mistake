<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Video Uploader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google-signin-client_id" content="143618709913-c87kg55fruv738c95hgcu470eqc35jj0.apps.googleusercontent.com">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    #successMessage {
      display: none;
      margin-top: 20px;
      padding: 10px;
      border-radius: 6px;
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
  </style>
</head>
<body>
  <h2>YouTube Video Uploader</h2>

  <div id="signinDiv"></div>
  <p id="signinStatus">Not signed in</p>

  <form id="uploadForm" style="display:none;">
    <label>Title:</label><br>
    <input type="text" id="title" required><br><br>

    <label>Description:</label><br>
    <textarea id="description" required></textarea><br><br>

    <label>Select Video:</label><br>
    <input type="file" id="video" accept="video/*" required><br><br>

    <label><input type="checkbox" id="madeForKids"> Made for kids</label><br><br>

    <button type="submit">Upload</button>
  </form>

  <div id="successMessage"></div>

  <script>
    let tokenClient;
    let accessToken = null;

    function initGoogleClient() {
      gapi.load('client', () => {
        gapi.client.init({
          apiKey: 'AIzaSyDvlQjFdyA3CT4wksuA1gD2QJ6DZOY_A3w',
          discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest']
        }).then(() => {
          tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: '143618709913-c87kg55fruv738c95hgcu470eqc35jj0.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/youtube.upload',
            callback: (tokenResponse) => {
              accessToken = tokenResponse.access_token;
              gapi.client.setToken({ access_token: accessToken });

              document.getElementById('signinStatus').textContent = "Signed in";
              document.getElementById('uploadForm').style.display = 'block';
              document.getElementById('signinDiv').style.display = 'none';
            },
          });

          const button = document.createElement("button");
          button.textContent = "Sign in with Google";
          button.onclick = () => tokenClient.requestAccessToken();
          document.getElementById('signinDiv').appendChild(button);
        });
      });
    }

    function showSuccessMessage(videoId) {
      const successDiv = document.getElementById('successMessage');
      successDiv.style.display = 'block';
      successDiv.innerHTML = `
        <strong>âœ… Upload Successful!</strong><br>
        Your video has been uploaded. <br>
        <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">Watch it on YouTube</a>
      `;
    }

    function uploadToYouTube(file, title, description, madeForKids) {
      const metadata = {
        snippet: {
          title,
          description,
          categoryId: '22'
        },
        status: {
          privacyStatus: 'public',
          madeForKids: madeForKids
        }
      };

      const uploader = new MediaUploader({
        baseUrl: 'https://www.googleapis.com/upload/youtube/v3/videos',
        file: file,
        token: accessToken,
        metadata: metadata,
        params: {
          part: 'snippet,status'
        },
        onComplete: function(data) {
          const response = JSON.parse(data);
          showSuccessMessage(response.id);
        },
        onError: function(error) {
          alert("Upload error: " + error);
        }
      });

      uploader.upload();
    }

    document.getElementById('uploadForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const file = document.getElementById('video').files[0];
      const title = document.getElementById('title').value;
      const description = document.getElementById('description').value;
      const madeForKids = document.getElementById('madeForKids').checked;

      if (!accessToken) {
        alert("You must sign in first.");
        return;
      }

      uploadToYouTube(file, title, description, madeForKids);
    });

    // MediaUploader class from Google's official YouTube uploader example
    class MediaUploader {
      constructor(options) {
        this.file = options.file;
        this.token = options.token;
        this.metadata = options.metadata;
        this.baseUrl = options.baseUrl;
        this.params = options.params;
        this.onComplete = options.onComplete;
        this.onError = options.onError;
        this.offset = 0;
        this.chunkSize = 262144; // 256 KB
        this.url = this.baseUrl + '?uploadType=resumable&' + new URLSearchParams(this.params).toString();
      }

      upload() {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', this.url, true);
        xhr.setRequestHeader('Authorization', 'Bearer ' + this.token);
        xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        xhr.setRequestHeader('X-Upload-Content-Length', this.file.size);
        xhr.setRequestHeader('X-Upload-Content-Type', this.file.type);

        xhr.onload = () => {
          if (xhr.status < 400 && xhr.status >= 200) {
            this.uploadFile(JSON.parse(xhr.response).uploadUrl);
          } else {
            this.onError(xhr.responseText);
          }
        };

        xhr.onerror = () => this.onError(xhr.responseText);
        xhr.send(JSON.stringify(this.metadata));
      }

      uploadFile(uploadUrl) {
        const xhr = new XMLHttpRequest();
        xhr.open('PUT', uploadUrl, true);
        xhr.setRequestHeader('Content-Type', this.file.type);
        xhr.setRequestHeader('Content-Length', this.file.size);
        xhr.onload = () => {
          if (xhr.status === 200 || xhr.status === 201) {
            this.onComplete(xhr.responseText);
          } else {
            this.onError(xhr.responseText);
          }
        };
        xhr.onerror = () => this.onError(xhr.responseText);
        xhr.send(this.file);
      }
    }

    window.onload = initGoogleClient;
  </script>
</body>
</html>
