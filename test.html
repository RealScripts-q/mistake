<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Channel Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google-signin-client_id" content="143618709913-c87kg55fruv738c95hgcu470eqc35jj0.apps.googleusercontent.com">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    /* Simple styling for the page */
    #videos { display: flex; flex-wrap: wrap; }
    .video {
      margin: 10px;
      width: 300px;
    }
    iframe {
      width: 100%;
      height: 200px;
    }
    #signinDiv {
      margin: 20px;
    }
  </style>
</head>
<body>
  <h2>Welcome to Your YouTube Channel Viewer</h2>

  <!-- Sign in button -->
  <div id="signinDiv"></div>
  <p id="signinStatus">Not signed in</p>

  <!-- Video container -->
  <div id="videos"></div>

  <script>
    let tokenClient;
    let accessToken = null;

    // Initialize the Google API client
    function initGoogleClient() {
      gapi.load('client', () => {
        gapi.client.init({
          apiKey: 'AIzaSyDvlQjFdyA3CT4wksuA1gD2QJ6DZOY_A3w',  // Your API Key
          discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest']
        }).then(() => {
          tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: '143618709913-c87kg55fruv738c95hgcu470eqc35jj0.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/youtube.readonly',
            callback: (tokenResponse) => {
              accessToken = tokenResponse.access_token;
              document.getElementById('signinStatus').textContent = "Signed in";
              document.getElementById('signinDiv').style.display = 'none';
              fetchUserVideos();
            },
          });

          // Show sign-in button
          const signinDiv = document.getElementById("signinDiv");
          const button = document.createElement("button");
          button.textContent = "Sign in with Google";
          button.onclick = () => tokenClient.requestAccessToken();
          signinDiv.appendChild(button);
        });
      });
    }

    // Fetch the user's videos from YouTube API
    function fetchUserVideos() {
      if (!accessToken) {
        alert("You must sign in first.");
        return;
      }

      gapi.client.youtube.channels.list({
        part: 'contentDetails',
        mine: true
      }).then((response) => {
        const channelId = response.result.items[0].id;

        // Now, get the uploads playlist to fetch user's videos
        gapi.client.youtube.playlistItems.list({
          part: 'snippet',
          playlistId: response.result.items[0].contentDetails.relatedPlaylists.uploads,
          maxResults: 10
        }).then((videoResponse) => {
          const videos = videoResponse.result.items;
          displayVideos(videos);
        });
      });
    }

    // Display the user's videos
    function displayVideos(videos) {
      const videosContainer = document.getElementById('videos');
      videosContainer.innerHTML = '';

      videos.forEach((video) => {
        const videoElement = document.createElement('div');
        videoElement.className = 'video';

        const videoTitle = document.createElement('h3');
        videoTitle.textContent = video.snippet.title;

        const videoIframe = document.createElement('iframe');
        videoIframe.src = `https://www.youtube.com/embed/${video.snippet.resourceId.videoId}`;
        videoIframe.frameborder = "0";
        videoIframe.allow = "accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture";
        videoIframe.allowfullscreen = true;

        videoElement.appendChild(videoTitle);
        videoElement.appendChild(videoIframe);

        videosContainer.appendChild(videoElement);
      });
    }

    // Call initGoogleClient on page load
    window.onload = initGoogleClient;
  </script>
</body>
</html>
