<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Auto Uploader</title>
  <meta name="google-signin-client_id" content="143618709913-c87kg55fruv738c95hgcu470eqc35jj0.apps.googleusercontent.com">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h2>YouTube Auto Uploader</h2>
  <p id="signinStatus">Not signed in</p>
  <input type="file" id="video" accept="video/*">
  <p id="countdown" style="display:none;">Uploading in <span id="timer">10</span> seconds...</p>

  <div id="successMessage" style="display:none; color:green;"></div>

  <script>
    let tokenClient;
    let accessToken = null;
    let countdownInterval;

    function initGoogleClient() {
      gapi.load('client', () => {
        gapi.client.init({
          apiKey: 'AIzaSyDvlQjFdyA3CT4wksuA1gD2QJ6DZOY_A3w',
          discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest']
        }).then(() => {
          tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: '143618709913-c87kg55fruv738c95hgcu470eqc35jj0.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/youtube.upload',
            callback: (tokenResponse) => {
              accessToken = tokenResponse.access_token;
              gapi.client.setToken({ access_token: accessToken });
              document.getElementById('signinStatus').textContent = "✅ Signed in";

              document.getElementById('video').addEventListener('change', () => {
                const file = document.getElementById('video').files[0];
                if (file) startCountdown(file);
              });
            },
          });

          const btn = document.createElement('button');
          btn.textContent = "Sign in with Google";
          btn.onclick = () => tokenClient.requestAccessToken();
          document.body.insertBefore(btn, document.getElementById('video'));
        });
      });
    }

    function startCountdown(file) {
      document.getElementById('countdown').style.display = 'block';
      let timeLeft = 10;
      document.getElementById('timer').textContent = timeLeft;

      countdownInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = timeLeft;
        if (timeLeft === 0) {
          clearInterval(countdownInterval);
          uploadToYouTube(file, "Minecraft Movie", "");
        }
      }, 1000);
    }

    function uploadToYouTube(file, title, description) {
      const metadata = {
        snippet: {
          title: title,
          description: description,
          categoryId: '22'
        },
        status: {
          privacyStatus: 'public',
          madeForKids: false
        }
      };

      const uploader = gapi.client.youtube.videos.insert({
        part: 'snippet,status',
        resource: metadata,
        media: {
          body: file
        }
      });

      uploader.execute((response) => {
        if (response.error) {
          alert("Upload failed: " + response.error.message);
        } else {
          const videoId = response.id;
          const msg = document.getElementById('successMessage');
          msg.innerHTML = `✅ Upload Successful! <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">Watch Video</a>`;
          msg.style.display = 'block';
        }
      });
    }

    window.onload = initGoogleClient;
  </script>
</body>
</html>
